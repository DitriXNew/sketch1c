//
//---
// Если ТекущиеДанные.Тип = Контейнер, тогда добавить в него. А если Не контейнер, то добавить рядом, но только то что доступно родителю!
//
//---
// ТипыЗначение ПоляФормы с видом ПолеВвода:
//   * Строка
//   * Число
//   * Булево
//   * Дата
//   * СтандартныйПериод

&НаКлиенте
Перем МенеджерПроекта;

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	СоздатьНовыйПроект();
	ОпределитьВидимостьПодсказокКоманд(Ложь);
	СкрытьВсеСтраницыКромеТекущей();

	//todo:
	//ИсходнаяСтруктура = Новый Структура;
	//ИсходнаяСтруктура.Вставить("Проект", "Проект");
	//ИсходнаяСтруктура.Вставить("Форма", "Форма");
	//ИсходнаяСтруктура.Вставить("Группа", "Группа");
	//ИсходнаяСтруктура.Вставить("Поле", "Поле");
	//ИсходнаяСтруктура.Вставить("Кнопку", "Кнопку");
	//ИсходнаяСтруктура.Вставить("Таблица", "Таблица");
	//ИсходнаяСтруктура.Вставить("Декорация", "Декорация");
	//
	//Типы = Новый ФиксированнаяСтруктура(ИсходнаяСтруктура);
	
	//todo:
	//НоваяСтрока = ФормыИЭлементыУправления.ПолучитьЭлементы().Добавить();
	//НоваяСтрока.Имя = "Проект";
	//НоваяСтрока.Тип = Типы.Проект;
	
КонецПроцедуры

&НаКлиенте
Процедура СоздатьНовыйПроект() 
	МенеджерПроекта = ПолучитьФорму("ВнешняяОбработка.Эскиз.Форма.Проект");
	МенеджерПроекта.Создать();
	
КонецПроцедуры

&НаКлиенте
Процедура ЗагрузитьПроект(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ВыбратьПроектЗавершение", ЭтотОбъект);
	
	ДиалогВыбораФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	ДиалогВыбораФайла.МножественныйВыбор = Ложь;
	ДиалогВыбораФайла.Показать(ОписаниеОповещения);
	
КонецПроцедуры

&НаКлиенте
Процедура ВыбратьПроектЗавершение(ВыбранныеФайлы, ДополнительныеПараметры) Экспорт
	Если Ложь
		Или ВыбранныеФайлы = Неопределено
		Или ВыбранныеФайлы.Количество() = 0
		Тогда
		
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Файл проекта не выбран.";
		Сообщение.Сообщить();	
		
		Возврат;
	КонецЕсли;
	
	РасположениеПроекта = ВыбранныеФайлы[0];
	
	МенеджерПроекта.Загрузить(РасположениеПроекта, ЭтаФорма);
	
	ОбновитьДеревоФормИЭлементов();
	
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьПроект(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ОткрытьПроектЗавершение", ЭтотОбъект);
	НачатьЗапускПриложения(ОписаниеОповещения, РасположениеПроекта);
	
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьПроектЗавершение(КодВозврата, ДополнительныеПараметры) Экспорт
	//	
КонецПроцедуры

&НаКлиенте
Процедура СохранитьПроект(Команда)
	Если ПустаяСтрока(РасположениеПроекта) Тогда
		ОписаниеОповещения = Новый ОписаниеОповещения("СохранитьПроектЗавершение", ЭтотОбъект);
		
		ДиалогВыбораФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Сохранение);
		ДиалогВыбораФайла.Расширение = "json";
		ДиалогВыбораФайла.Фильтр = "json|*.json";
		ДиалогВыбораФайла.Показать(ОписаниеОповещения);
		
	Иначе
		МенеджерПроекта.Сохранить(РасположениеПроекта);
		
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура СохранитьПроектЗавершение(ВыбранныеФайлы, ДополнительныеПараметры) Экспорт
	Если Ложь
		Или ВыбранныеФайлы = Неопределено
		Или ВыбранныеФайлы.Количество() = 0
		Тогда
		
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Файл проекта не выбран.";
		Сообщение.Сообщить();	
		
		Возврат;
	КонецЕсли;
	
	РасположениеПроекта = ВыбранныеФайлы[0];
	
	МенеджерПроекта.Сохранить(РасположениеПроекта);
	
КонецПроцедуры

&НаКлиенте                                         
Процедура РасположениеПроектаОчистка(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	
	Если ПустаяСтрока(РасположениеПроекта) Тогда
		Возврат;
	КонецЕсли;
	
	ОписаниеОповещения = Новый ОписаниеОповещения("РасположениеПроектаОчисткаЗавершение", ЭтотОбъект);
	ПоказатьВопрос(ОписаниеОповещения, "Поле ""Проект"" будет очищено! Продолжить?", РежимДиалогаВопрос.ДаНет, 60, КодВозвратаДиалога.Нет, "Эскиз", КодВозвратаДиалога.Нет);
	
КонецПроцедуры

&НаКлиенте
Процедура РасположениеПроектаОчисткаЗавершение(Ответ, ДополнительныеПараметры) Экспорт
	Если Ответ = КодВозвратаДиалога.Да Тогда
		РасположениеПроекта = "";
		
		СоздатьНовыйПроект();
		
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ОбновитьДеревоФормИЭлементов() 
	
КонецПроцедуры

//---

&НаКлиенте
Процедура ДобавитьФорму(Команда)
	НоваяСтрока = ФормыИЭлементыУправления.ПолучитьЭлементы().Добавить();
	НоваяСтрока.ИндексКартинки = 0;
	
	НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("Форма");
	НоваяСтрока.Имя = НовоеИмя;
	НоваяСтрока.Заголовок = НовоеИмя;
	НоваяСтрока.Тип = МенеджерПроекта.Типы().ФормаКлиентскогоПриложения;
	НоваяСтрока.Идентификатор = Новый УникальныйИдентификатор;
	
	МенеджерПроекта.ОткрытьПрототип(НоваяСтрока, ЭтаФорма, Ложь);
	
	Элементы.ФормыИЭлементыУправления.ТекущаяСтрока = НоваяСтрока.ПолучитьИдентификатор();
	
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьПрототип(Команда)
	ТекущиеДанные = Элементы.ФормыИЭлементыУправления.ТекущиеДанные;
	Если Ложь
		Или ТекущиеДанные = Неопределено
		Или ТекущиеДанные.Тип <> МенеджерПроекта.Типы().ФормаКлиентскогоПриложения
		Тогда
		
		ТекстСообщения = "Выберите (установите курсор) форму.";
		
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = ТекстСообщения;
		Сообщение.Сообщить();
		
		Возврат;
	КонецЕсли;
	
	МенеджерПроекта.ОткрытьПрототип(ТекущиеДанные, ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьГруппу(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().ГруппаФормы, МенеджерПроекта.Виды().ОбычнаяГруппа);

КонецПроцедуры

&НаКлиенте
Процедура ДобавитьКоманднуюПанель(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().ГруппаФормы, МенеджерПроекта.Виды().КоманднаяПанель);

КонецПроцедуры

&НаКлиенте
Процедура ДобавитьСтраницы(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().ГруппаФормы, МенеджерПроекта.Виды().Страницы);

КонецПроцедуры

&НаКлиенте
Процедура ДобавитьКнопку(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().КнопкаФормы, МенеджерПроекта.Виды().ОбычнаяКнопка);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьКнопкуКоманднойПанели(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().КнопкаФормы, МенеджерПроекта.Виды().КнопкаКоманднойПанели);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьГиперссылку(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().КнопкаФормы, МенеджерПроекта.Виды().Гиперссылка);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьГиперссылкуКоманднойПанели(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().КнопкаФормы, МенеджерПроекта.Виды().ГиперссылкаКоманднойПанели);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьПоле(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().ПолеФормы, МенеджерПроекта.Виды().ПолеВвода);

КонецПроцедуры

&НаКлиенте
Процедура ДобавитьФлажок(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().ПолеФормы, МенеджерПроекта.Виды().ПолеФлажка);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьПереключатель(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().ПолеФормы, МенеджерПроекта.Виды().ПолеПереключателя);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьТаблицу(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().ТаблицаФормы,, МенеджерПроекта.ТипыЗначения().ТаблицаЗначений);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьДерево(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().ТаблицаФормы,, МенеджерПроекта.ТипыЗначения().ДеревоЗначений);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьНадпись(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().ДекорацияФормы, МенеджерПроекта.Виды().Надпись);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьКартинку(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().ДекорацияФормы, МенеджерПроекта.Виды().Картинка);
	
КонецПроцедуры

//---

&НаКлиенте
Процедура РедактироватьРоли(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	ПараметрыФормыРолей = Новый Структура;
	ПараметрыФормыРолей.Вставить("РежимРедактированияРолей", Истина);
	ПараметрыФормыРолей.Вставить("ТекущаяРоль", ДанныеВыбора);
	
	ОписаниеОповещенияОЗакрытии = Новый ОписаниеОповещения("РедактироватьРолиЗавершение", ЭтотОбъект);
	ОткрытьФорму("ВнешняяОбработка.Эскиз.Форма.Роли", ПараметрыФормыРолей, Элементы.Роль,,,, ОписаниеОповещенияОЗакрытии, РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
	
КонецПроцедуры

&НаКлиенте
Процедура РедактироватьРолиЗавершение(РезультатЗакрытия, ДополнительныеПараметры) Экспорт
	Если РезультатЗакрытия = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Элементы.Роль.СписокВыбора.ЗагрузитьЗначения(РезультатЗакрытия.ВыгрузитьЗначения());
	
КонецПроцедуры

&НаКлиенте
Процедура Предастройки(Команда)
	Сообщение = Новый СообщениеПользователю;
	Сообщение.Текст = "Группировки, сортировки, отборы, поиски!";
	Сообщение.Сообщить();	
	
КонецПроцедуры

&НаКлиенте
Функция ПолучитьИмяПрототипаРекурсивно(Элемент) 
	Результат = "";
	
	Родитель = Элемент.ПолучитьРодителя();
	Если Родитель = Неопределено Тогда
		Результат = Элемент.Имя;
		
	Иначе
		Результат = ПолучитьИмяПрототипаРекурсивно(Родитель);
		
	КонецЕсли;
	
	Возврат Результат;
КонецФункции

&НаКлиенте
Процедура ФормыИЭлементыУправленияПриАктивизацииСтроки(Элемент)
	ОбработкаАктивизацииСтрокиФормИЭлементов();
	
	//---
	ТекущиеДанные = Элементы.ФормыИЭлементыУправления.ТекущиеДанные;
	Если ТекущиеДанные = Неопределено Тогда
		Элементы.ГруппаКоманды.ТекущаяСтраница = Элементы.ГруппаКоманды_НачалоРаботы;
		
	ИначеЕсли ТекущиеДанные.Тип = МенеджерПроекта.Типы().ГруппаФормы Тогда
		Если ТекущиеДанные.Вид = МенеджерПроекта.Виды().Страницы Тогда
			Элементы.ГруппаКоманды.ТекущаяСтраница = Элементы.ГруппаКоманды_Страницы;
			
		ИначеЕсли Ложь
			Или ТекущиеДанные.Вид = МенеджерПроекта.Виды().КоманднаяПанель
			Или ТекущиеДанные.Вид = МенеджерПроекта.Виды().Подменю
			Или ТекущиеДанные.Вид = МенеджерПроекта.Виды().ГруппаКнопок
			Тогда
			
			Элементы.ГруппаКоманды.ТекущаяСтраница = Элементы.ГруппаКоманды_КоманднаяПанель;
			
		ИначеЕсли ТекущиеДанные.Вид = МенеджерПроекта.Виды().ГруппаКолонок Тогда
			Элементы.ГруппаКоманды.ТекущаяСтраница = Элементы.ГруппаКоманды_Таблица;

		КонецЕсли;
	ИначеЕсли ТекущиеДанные.Тип = МенеджерПроекта.Типы().ТаблицаФормы Тогда
		Элементы.ГруппаКоманды.ТекущаяСтраница = Элементы.ГруппаКоманды_Таблица;
		
	Иначе
		Элементы.ГруппаКоманды.ТекущаяСтраница = Элементы.ГруппаКоманды_Все;
		
	КонецЕсли;
	
	СкрытьВсеСтраницыКромеТекущей();
	
КонецПроцедуры

&НаКлиенте
Процедура СкрытьВсеСтраницыКромеТекущей() 
	ТекущаяСтраница = Элементы.ГруппаКоманды.ТекущаяСтраница;
	
	Страницы = Элементы.ГруппаКоманды.ПодчиненныеЭлементы;
	Для Каждого Страница Из Страницы Цикл
		Страница.Видимость = Страница = ТекущаяСтраница;
		
	КонецЦикла;
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаАктивизацииСтрокиФормИЭлементов() Экспорт
	ТекущиеДанные = Элементы.ФормыИЭлементыУправления.ТекущиеДанные;
	Если ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Для Каждого Строка Из СвойстваФормИЭлементовУправления Цикл
		Попытка
			Строка.Значение = ТекущиеДанные[Строка.Свойство];
			
		Исключение
			
		КонецПопытки;
	КонецЦикла;
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ЗаполнитьСвойства();
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьСвойства() 
	СвойстваНаСервере = РеквизитФормыВЗначение("СвойстваФормИЭлементовУправления");
	
	//---
	ДобавитьСвойство(СвойстваНаСервере, "Заголовок", "Заголовок", "", Новый СписокЗначений);
	
	//---
	ДанныеВыбора = Новый Структура;
	ДанныеВыбора.Вставить("Вертикальная", "Вертикальная");
	ДанныеВыбора.Вставить("ГоризонтальнаяВсегда", "Горизонтальная всегда");
	ДанныеВыбора.Вставить("ГоризонтальнаяЕслиВозможно", "Горизонтальная если возможно");
	
	ДобавитьСвойство(СвойстваНаСервере, "Группировка", "Группировка", "Вертикальная", ДанныеВыбора);
	
	//---
	ДанныеВыбора = Новый Структура;
	ДанныеВыбора.Вставить("Да", "Да");
	ДанныеВыбора.Вставить("Нет", "Нет");
	
	ДобавитьСвойство(СвойстваНаСервере, "ОтображатьЗаголовок", "Отображать заголовок", "Да", ДанныеВыбора);
	
	//---
	ДанныеВыбора = Новый Структура;
	ДанныеВыбора.Вставить("Строка", "Строка");
	ДанныеВыбора.Вставить("Число", "Число");
	ДанныеВыбора.Вставить("Дата", "Дата");
	ДанныеВыбора.Вставить("Булево", "Булево");
	
	ДобавитьСвойство(СвойстваНаСервере, "Тип", "Тип", "Строка", ДанныеВыбора);
	
	
	
	
	
	
	ЗначениеВРеквизитФормы(СвойстваНаСервере, "СвойстваФормИЭлементовУправления");
	
КонецПроцедуры

&НаСервере
Процедура ДобавитьСвойство(СвойстваНаСервере, Свойство, Представление, Значение, ДанныеВыбора) 
	НоваяСтрока = СвойстваНаСервере.Добавить();
	НоваяСтрока.Свойство = Свойство;
	НоваяСтрока.Представление = Представление;
	НоваяСтрока.Значение = Значение;
	
	Для Каждого Пара Из ДанныеВыбора Цикл
		НоваяСтрока.ДанныеВыбора.Добавить(Пара.Ключ, Пара.Значение);
		
	КонецЦикла;
КонецПроцедуры

&НаКлиенте
Процедура ЗначениеПриИзменении(Элемент)
	ТекущиеДанныеПрототип = Элементы.ФормыИЭлементыУправления.ТекущиеДанные;
	Если ТекущиеДанныеПрототип = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	ТекущиеДанныеСвойств = Элементы.СвойстваФормИЭлементовУправления.ТекущиеДанные;
	Если ТекущиеДанныеСвойств = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Если ТекущиеДанныеПрототип.Тип = МенеджерПроекта.Типы().ФормаКлиентскогоПриложения Тогда
		Прототип = ТекущиеДанныеПрототип.Имя;
		МенеджерПроекта.ИзменитьСвойство(Прототип, ТекущиеДанныеСвойств.Свойство, ТекущиеДанныеСвойств.Значение);
		
	Иначе
		Прототип = ПолучитьИмяПрототипаРекурсивно(ТекущиеДанныеПрототип);
		Если ТекущиеДанныеСвойств.Свойство = "Тип" Тогда
			
			
		Иначе
			МенеджерПроекта.ИзменитьСвойство(Прототип, ТекущиеДанныеСвойств.Свойство, ТекущиеДанныеСвойств.Значение, Ложь, ТекущиеДанныеПрототип.Имя);
			
		КонецЕсли;
	КонецЕсли;
	
	Если ТекущиеДанныеСвойств.Свойство = МенеджерПроекта.СвойстваФормИЭлементов().Заголовок Тогда
		ТекущиеДанныеПрототип.Заголовок = ТекущиеДанныеСвойств.Значение;
		
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Функция ПолучитьЭлементМаркер() 
	Результат = Неопределено;
	
	ТекущиеДанные = Элементы.ФормыИЭлементыУправления.ТекущиеДанные;
	
	Родитель = ТекущиеДанные.ПолучитьРодителя();
	Если Родитель = Неопределено Тогда
		Возврат Результат;
	КонецЕсли;
	
	ВзятьСледующий = Ложь;
	
	Стек = Родитель.ПолучитьЭлементы();
	Для Каждого Элемент Из Стек Цикл
		Если ВзятьСледующий Тогда
			Результат = Элемент.Заголовок;
			
			Прервать;
		ИначеЕсли Элемент.Имя = ТекущиеДанные.Имя Тогда
			ВзятьСледующий = Истина;
			
		КонецЕсли;
	КонецЦикла;
	
	Возврат Результат;    
КонецФункции

&НаКлиенте
Процедура ДобавитьСтраницу(Команда)
	НоваяСтрока = ФормыИЭлементыУправления.ПолучитьЭлементы().Добавить();
	НоваяСтрока.ИндексКартинки = 18;
	
	НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("Страница");
	НоваяСтрока.Имя = НовоеИмя;
	НоваяСтрока.Заголовок = НовоеИмя;
	
	НоваяСтрока.Тип = МенеджерПроекта.Типы().ГруппаФормы;
	НоваяСтрока.Вид = МенеджерПроекта.Виды().Страница;
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьИндикатор(Команда)
	НоваяСтрока = ФормыИЭлементыУправления.ПолучитьЭлементы().Добавить();
	НоваяСтрока.ИндексКартинки = 11;
	
	НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("Индикатор");
	НоваяСтрока.Имя = НовоеИмя;
	НоваяСтрока.Заголовок = НовоеИмя;
	
	НоваяСтрока.Тип = МенеджерПроекта.Типы().ПолеФормы;
	НоваяСтрока.Вид = МенеджерПроекта.Виды().ПолеИндикатора;
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьПолосуРегулирования(Команда)
	НоваяСтрока = ФормыИЭлементыУправления.ПолучитьЭлементы().Добавить();
	НоваяСтрока.ИндексКартинки = 17;
	
	НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("ПолосаРегулирования");
	НоваяСтрока.Имя = НовоеИмя;
	НоваяСтрока.Заголовок = НовоеИмя;
	
	НоваяСтрока.Тип = МенеджерПроекта.Типы().ПолеФормы;
	НоваяСтрока.Вид = МенеджерПроекта.Виды().ПолеПолосыРегулирования;
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьКалендарь(Команда)
	НоваяСтрока = ФормыИЭлементыУправления.ПолучитьЭлементы().Добавить();
	НоваяСтрока.ИндексКартинки = 12;
	
	НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("Календарь");
	НоваяСтрока.Имя = НовоеИмя;
	НоваяСтрока.Заголовок = НовоеИмя;
	
	НоваяСтрока.Тип = МенеджерПроекта.Типы().ПолеФормы;
	НоваяСтрока.Вид = МенеджерПроекта.Виды().ПолеКалендаря;
	
КонецПроцедуры

&НаКлиенте
Функция ДобавитьСтрокуВставкой(ТекущиеДанные) 
	Результат = Неопределено;
	
	СтрокиУровня = ТекущиеДанные.ПолучитьРодителя().ПолучитьЭлементы();
	Для Каждого Строка Из СтрокиУровня Цикл
		Если Строка.Имя = ТекущиеДанные.Имя Тогда
			ИндексВставки = СтрокиУровня.Индекс(Строка) + 1;
			
			Прервать;
		КонецЕсли;
	КонецЦикла;
	
	Результат = СтрокиУровня.Вставить(ИндексВставки);
	
	Возврат Результат;
КонецФункции


&НаКлиенте
Процедура ДобавитьЭлементУправления(Тип, Вид = Неопределено, ТипЗначения = Неопределено)
	ТекущиеДанные = Элементы.ФормыИЭлементыУправления.ТекущиеДанные;
	Если Ложь
		Или ТекущиеДанные.Тип = МенеджерПроекта.Типы().ФормаКлиентскогоПриложения
		Или ТекущиеДанные.Тип = МенеджерПроекта.Типы().ГруппаФормы
		Или ТекущиеДанные.Тип = МенеджерПроекта.Типы().ТаблицаФормы
		Тогда
		
		НоваяСтрока = ТекущиеДанные.ПолучитьЭлементы().Добавить();
		Родитель = ТекущиеДанные;
		
	Иначе
		НоваяСтрока = ДобавитьСтрокуВставкой(ТекущиеДанные);
		Родитель = ТекущиеДанные.ПолучитьРодителя();

	КонецЕсли;
	
	НоваяСтрока.Тип = Тип;
	НоваяСтрока.Вид = Вид;
	
	Если Родитель.Тип <> МенеджерПроекта.Типы().ФормаКлиентскогоПриложения Тогда
		НоваяСтрока.Родитель = Родитель.Имя;
		
	КонецЕсли;
	
	НоваяСтрока.Прототип = ПолучитьИмяПрототипаРекурсивно(Родитель);
	
	Если Тип = МенеджерПроекта.Типы().ГруппаФормы Тогда
		Если Вид = МенеджерПроекта.Виды().ОбычнаяГруппа Тогда
			НоваяСтрока.ИндексКартинки = 2;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("Группа");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			
			Ключи = "Имя,Заголовок,Тип,Родитель,Прототип";
			Связать = Ложь;
			Перемещение = Ложь;
			
		ИначеЕсли Вид = МенеджерПроекта.Виды().КоманднаяПанель Тогда
			НоваяСтрока.ИндексКартинки = 1;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("КоманднаяПанель");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			
			Ключи = "Имя,Заголовок,Тип,Родитель,Прототип";
			Связать = Ложь;
			Перемещение = Ложь;
			
		ИначеЕсли Вид = МенеджерПроекта.Виды().Страницы Тогда
			НоваяСтрока.ИндексКартинки = 19;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("Страницы");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			
			Ключи = "Имя,Заголовок,Тип,Родитель,Прототип";
			Связать = Ложь;
			Перемещение = Ложь;
			
		КонецЕсли;
	ИначеЕсли Тип = МенеджерПроекта.Типы().ПолеФормы Тогда
		Если Вид = МенеджерПроекта.Виды().ПолеВвода Тогда
			НоваяСтрока.ИндексКартинки = 3;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("Поле");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.ПутьКДанным = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			НоваяСтрока.Путь = "";
			
			Ключи = "Имя,ПутьКДанным,Заголовок,Тип,ТипЗначения,Родитель,Вид,Путь,Прототип";
			Связать = Истина;
			Перемещение = Ложь;
			
		ИначеЕсли Вид = МенеджерПроекта.Виды().ПолеФорматированногоДокумента Тогда
			НоваяСтрока.ИндексКартинки = 23;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("ФорматированныйДокумент");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.ПутьКДанным = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			НоваяСтрока.Путь = "";
			
			Ключи = "Имя,ПутьКДанным,Заголовок,Тип,ТипЗначения,Родитель,Вид,Путь,Прототип";
			Связать = Истина;
			Перемещение = Ложь;
			
		ИначеЕсли Вид = МенеджерПроекта.Виды().ПолеНадписи Тогда // Только для форматированного документа, остальное - Надпись)
			НоваяСтрока.ИндексКартинки = 26;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("ФорматированнаяСтрока");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.ПутьКДанным = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			НоваяСтрока.Путь = "";
			
			Ключи = "Имя,ПутьКДанным,Заголовок,Тип,ТипЗначения,Родитель,Вид,Путь,Прототип";
			Связать = Истина;
			Перемещение = Ложь;
			
		ИначеЕсли Вид = МенеджерПроекта.Виды().ПолеТекстовогоДокумента Тогда
			НоваяСтрока.ИндексКартинки = 24;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("ТекстовыйДокумент");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.ПутьКДанным = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			НоваяСтрока.Путь = "";
			
			Ключи = "Имя,ПутьКДанным,Заголовок,Тип,ТипЗначения,Родитель,Вид,Путь,Прототип";
			Связать = Истина;
			Перемещение = Ложь;
			
		ИначеЕсли Вид = МенеджерПроекта.Виды().ПолеТабличногоДокумента Тогда
			НоваяСтрока.ИндексКартинки = 25;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("ТабличныйДокумент");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.ПутьКДанным = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			НоваяСтрока.Путь = "";
			
			Ключи = "Имя,ПутьКДанным,Заголовок,Тип,ТипЗначения,Родитель,Вид,Путь,Прототип";
			Связать = Истина;
			Перемещение = Ложь;
			
		ИначеЕсли Вид = МенеджерПроекта.Виды().ПолеФлажка Тогда
			НоваяСтрока.ИндексКартинки = 20;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("Флажок");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			
			Ключи = "Имя,ПутьКДанным,Заголовок,Тип,ТипЗначения,Родитель,Вид,Путь,Прототип";
			Связать = Истина;
			Перемещение = Ложь;
			
		ИначеЕсли Вид = МенеджерПроекта.Виды().ПолеПереключателя Тогда
			НоваяСтрока.ИндексКартинки = 15;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("Переключатель");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			
			Ключи = "Имя,ПутьКДанным,Заголовок,Тип,ТипЗначения,Родитель,Вид,Путь,Прототип";
			Связать = Истина;
			Перемещение = Ложь;
			
		КонецЕсли;
	ИначеЕсли Тип = МенеджерПроекта.Типы().КнопкаФормы Тогда
		Если Вид = МенеджерПроекта.Виды().ОбычнаяКнопка Тогда
			НоваяСтрока.ИндексКартинки = 4;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("Кнопка");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			
			Ключи = "Имя,ПутьКДанным,Заголовок,Тип,ТипЗначения,Родитель,Вид,Путь,Прототип";
			Связать = Истина;
			Перемещение = Ложь;
			
		ИначеЕсли Вид = МенеджерПроекта.Виды().Гиперссылка Тогда
			НоваяСтрока.ИндексКартинки = 21;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("Кнопка");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			
			Ключи = "Имя,ПутьКДанным,Заголовок,Тип,ТипЗначения,Родитель,Вид,Путь,Прототип";
			Связать = Истина;
			Перемещение = Ложь;
			
		КонецЕсли;
	ИначеЕсли Тип = МенеджерПроекта.Типы().ТаблицаФормы Тогда
		Если ТипЗначения = МенеджерПроекта.ТипыЗначения().ТаблицаЗначений Тогда
			НоваяСтрока.ИндексКартинки = 7;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("Таблица");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			
			НоваяСтрока.Тип = МенеджерПроекта.Типы().ТаблицаФормы;
			
			Ключи = "Имя,ПутьКДанным,Заголовок,Тип,ТипЗначения,Родитель,Вид,Путь,Прототип";
			Связать = Истина;
			Перемещение = Ложь;
			
		ИначеЕсли ТипЗначения = МенеджерПроекта.ТипыЗначения().ДеревоЗначений Тогда
			НоваяСтрока.ИндексКартинки = 8;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("Дерево");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			
			Ключи = "Имя,ПутьКДанным,Заголовок,Тип,ТипЗначения,Родитель,Вид,Путь,Прототип";
			Связать = Истина;
			Перемещение = Ложь;
			
		КонецЕсли;
	ИначеЕсли Тип = МенеджерПроекта.Типы().ДекорацияФормы Тогда
		Если Вид = МенеджерПроекта.Виды().Надпись Тогда
			НоваяСтрока.ИндексКартинки = 5;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("Надпись");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			
			Ключи = "Имя,ПутьКДанным,Заголовок,Тип,ТипЗначения,Родитель,Вид,Путь,Прототип";
			Связать = Ложь;
			Перемещение = Ложь;
			
		ИначеЕсли Вид = МенеджерПроекта.Виды().Картинка Тогда
			НоваяСтрока.ИндексКартинки = 13;
			
			НовоеИмя = МенеджерПроекта.ПолучитьНовоеИмя("Картинка");
			НоваяСтрока.Имя = НовоеИмя;
			НоваяСтрока.Заголовок = НовоеИмя;
			
			Ключи = "Имя,ПутьКДанным,Заголовок,Тип,ТипЗначения,Родитель,Вид,Путь,Прототип";
			Связать = Ложь;
			Перемещение = Ложь;
			
		КонецЕсли;
	КонецЕсли;

	СвойстваЭлементаУправления = Новый Структура(Ключи);
	ЗаполнитьЗначенияСвойств(СвойстваЭлементаУправления, НоваяСтрока);
	
	МенеджерПроекта.ДобавитьЭлементУправления(СвойстваЭлементаУправления, Связать, Перемещение);
	
	Элементы.ФормыИЭлементыУправления.ТекущаяСтрока = НоваяСтрока.ПолучитьИдентификатор();
	
КонецПроцедуры

&НаКлиенте
Процедура ВидимостьПодсказокКоманд(Команда)
	ОпределитьВидимостьПодсказокКоманд();
	
КонецПроцедуры

&НаКлиенте
Процедура ОпределитьВидимостьПодсказокКоманд(ЭтоИзменение = Истина) 
	Если ЭтоИзменение Тогда
		ПоказыватьПодсказкиКоманд = Не ПоказыватьПодсказкиКоманд;
		
	КонецЕсли;
	
	Если ПоказыватьПодсказкиКоманд Тогда
		ВариантОтображенияПодсказки = ОтображениеПодсказки.ОтображатьСправа;
		
	Иначе
		ВариантОтображенияПодсказки = ОтображениеПодсказки.Нет;
		
	КонецЕсли;

	Страницы = Элементы.ГруппаКоманды.ПодчиненныеЭлементы;
	Для Каждого Страница Из Страницы Цикл
		ЭлементыСтраницы = Страница.ПодчиненныеЭлементы;
		Для Каждого ЭлементСтраницы Из ЭлементыСтраницы Цикл
			Если Истина
				И ТипЗнч(ЭлементСтраницы) = Тип("КнопкаФормы")
				И ЭлементСтраницы.ИмяКоманды <> "ВидимостьПодсказокКоманд"
				Тогда
				
				ЭлементСтраницы.ОтображениеПодсказки = ВариантОтображенияПодсказки;

			КонецЕсли;
		КонецЦикла;
	КонецЦикла;
КонецПроцедуры

&НаКлиенте
Процедура СвойстваФормИЭлементовУправленияПриНачалеРедактирования(Элемент, НоваяСтрока, Копирование)
	ТекущиеДанные = Элементы.СвойстваФормИЭлементовУправления.ТекущиеДанные;
	Если Элемент.ТекущийЭлемент.Имя = "Свойство" Тогда
		Возврат;
	КонецЕсли;

	Если ТекущиеДанные.ДанныеВыбора.Количество() Тогда
		Если ТекущиеДанные = Неопределено Тогда
			Возврат;
		КонецЕсли;
		
		ОписаниеОповещения = Новый ОписаниеОповещения("СвойстваФормИЭлементовУправленияПриАктивизацииЯчейкиЗавершение", ЭтотОбъект);
		ПоказатьВыборИзСписка(ОписаниеОповещения, ТекущиеДанные.ДанныеВыбора, Элементы.СвойстваФормИЭлементовУправления.ТекущийЭлемент);
		
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура СвойстваФормИЭлементовУправленияПриАктивизацииЯчейкиЗавершение(ВыбранныйЭлемент, ДополнительныеПараметры) Экспорт
	ТекущиеДанные = Элементы.СвойстваФормИЭлементовУправления.ТекущиеДанные;
	Если Не ВыбранныйЭлемент = Неопределено Тогда
		ТекущиеДанные.Значение = ВыбранныйЭлемент.Значение;
		
		ЗначениеПриИзменении(Неопределено);
		
	КонецЕсли;
	
	Элементы.СвойстваФормИЭлементовУправления.ЗакончитьРедактированиеСтроки(Ложь);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьФорматированныйДокумент(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().ПолеФормы, МенеджерПроекта.Виды().ПолеФорматированногоДокумента);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьФорматированнуюСтроку(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().ПолеФормы, МенеджерПроекта.Виды().ПолеНадписи);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьТекстовыйДокумент(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().ПолеФормы, МенеджерПроекта.Виды().ПолеТекстовогоДокумента);
	
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьТабличныйДокумент(Команда)
	ДобавитьЭлементУправления(МенеджерПроекта.Типы().ПолеФормы, МенеджерПроекта.Виды().ПолеТабличногоДокумента);
	
КонецПроцедуры


